"use strict";(self.webpackChunkcom_foxdebug_acode=self.webpackChunkcom_foxdebug_acode||[]).push([[104],{45040:function(e,t,r){r.r(t),r.d(t,{default:function(){return H}});var n=r(72050),a=r(7449),i=r(64922),o=r(49673),s=r.n(o),c=r(89184),u=r.n(c),l=r(30011),d=r(71530),p=r(23324),f=r(93101),h=r(65586),m=r(59661),v=r(79583);function g(e){var t=(0,d.Z)(strings.settings.capitalize()),r=u()("div",{className:"main list"});actionStack.push({id:"settings-theme",action:t.hide}),t.onhide=function(){actionStack.remove("settings-theme")};var n=appSettings.value.fileBrowser,a=[{key:"sort",text:strings["sort by name"],checkbox:n.sortByName},{key:"show",text:strings["show hidden files"],checkbox:n.showHiddenFiles}];v.Z.listItems(r,a,(function(){switch(this.key){case"sort":n.sortByName=!n.sortByName,appSettings.update(),this.value=n.sortByName,e&&e();break;case"show":n.showHiddenFiles=!n.showHiddenFiles,appSettings.update(),this.value=n.showHiddenFiles,e&&e()}})),t.appendChild(r),document.body.append(t)}var y="<div tabindex='-1' class='main' id='file-browser' type='{{type}}'>\r\n  <div class='navigation' tabindex='-1'></div>\r\n  <div class='info'>â“˜ {{info}}</div>\r\n</div>",b='<ul class="list" id="list" empty-msg="{{msg}}">{{#list}}\r\n  {{#.}}\r\n  <li \r\n    tabindex="1" \r\n    class="tile" \r\n    action="open" \r\n    type="{{type}}" \r\n    name="{{name}}"\r\n    {{#home}}home="{{.}}"{{/home}}\r\n    {{#open-doc}}open-doc="true"{{/open-doc}} \r\n    {{#ftp-account}}ftp-account{{/ftp-account}}\r\n    {{#disabled}}disabled{{/disabled}}\r\n    {{#uuid}}uuid="{{uuid}}"{{/uuid}} \r\n    {{#storageType}}storageType="{{.}}"{{/storageType}}\r\n  >\r\n    <span \r\n      class="icon {{icon}} {{#uuid}}user-added-storage{{/uuid}}" \r\n      {{#storageType}}storageType="{{.}}"{{/storageType}}\r\n    ></span>\r\n    \r\n    <div class="text">\r\n      <span>{{name}}</span>\r\n    </div>\r\n    <data-url>{{url}}</data-url>\r\n  </li>\r\n  {{/.}}\r\n  {{/list}}\r\n</ul>',x='<li action="create" value="file">{{new file}}</li>\r\n<li action="create" value="folder">{{new folder}}</li>\r\n<li action="create" value="project">{{new project}}</li>',Z="<li action='add-path' {{#addPathNotice}}class=\"notice\"{{/addPathNotice}}>{{add path}}</li>\r\n<li action='addFtp'>{{add ftp}}</li>\r\n<li action='addSftp' {{#addSftpNotice}}class=\"notice\"{{/addSftpNotice}}>{{add sftp}}</li>",w=r(18595),k=r(91400),S=r(64413),O={angular:function(){return r.e(380).then(r.bind(r,40912))},angularjs:function(){return r.e(182).then(r.bind(r,43583))},html:function(){return r.e(566).then(r.bind(r,60039))},react:function(){return r.e(514).then(r.bind(r,46055))},vue:function(){return r.e(485).then(r.bind(r,11820))}},A=r(4286);function P(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function F(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?P(Object(r),!0).forEach((function(t){(0,i.Z)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):P(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var j=function(e,t,r){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};e.push(F({url:r,name:t,isDirectory:!0,parent:!0,type:"dir"},n))},_=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1?arguments[1]:void 0;return new Promise((function(r,n){h.Z.multiPrompt(strings["add path"],[{id:"uri",placeholder:strings["select folder"],type:"text",required:!0,readOnly:!0,onclick:function(){var e=this;sdcard.getStorageAccessPermission(t,(function(t){var r=u().get("#name");if(!r.value&&t){var n,a,i=null===(n=window.decodeURIComponent(t))||void 0===n||null===(a=n.split(":").pop())||void 0===a?void 0:a.split("/").pop();r.value=null!=i?i:""}e.value=t}),(function(e){p.Z.error(e)}))}},{id:"name",placeholder:strings["folder name"],type:"text",required:!0,value:e}],"https://acode.foxdebug.com/faqs/224761680").then((function(e){var t=e.name,n=e.uri;r({name:t,uri:n,uuid:p.Z.uuid()})}))}))},T=r(7079),N=r(63536),D=r(37827),E=r(84662),I=r(5174),L=r(86163),C=r.n(L),R={addFtp:function(){var e=arguments,t=this;return(0,a.Z)(s().mark((function r(){var n,a,i,o,c,u,l,d,f,m,v,g,y,b,x,Z;return s().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return Z=function(e,t,r,n,a,i,o){return a=a||21,i=i||"ftp",o=o||"passive",h.Z.multiPrompt(strings["add ftp"],[{id:"alias",placeholder:"Name",type:"text",value:n||"",required:!0},{id:"username",placeholder:"Username (optional)",type:"text",value:e},{id:"hostname",placeholder:"Hostname",type:"text",required:!0,value:r},{id:"password",placeholder:"Password (optional)",type:"password",value:t},["Security type: ",{id:"ftp",placeholder:"FTP",name:"type",type:"radio",value:"ftp"===i},{id:"ftps",placeholder:"FTPS",name:"type",type:"radio",value:"ftps"===i}],["Connection mode: ",{id:"active",placeholder:"Active",name:"mode",type:"radio",value:"active"===o},{id:"passive",placeholder:"Passive",name:"mode",type:"radio",value:"passive"===o}],{id:"port",placeholder:"Port (optional)",type:"number",value:a}])},n=!1,r.next=4,Z.apply(void 0,(0,D.Z)(e));case 4:return a=r.sent,i=a.username,o=a.password,c=a.hostname,u=a.port,l=a.ftps,d=a.active,f=a.alias,m=l?"ftps":"ftp",v=d?"active":"passive",g=(0,I.Z)(i,o,c,u,m,v),r.prev=15,h.Z.loader.create(strings["add ftp"],strings.connecting+"...",{timeout:1e4,callback:function(){n=!0}}),r.next=19,g.homeDirectory();case 19:if(y=r.sent,!n){r.next=23;break}return n=!1,r.abrupt("return");case 23:return b=A.Z.formate({protocol:"ftp:",username:i,password:o,hostname:c,port:u,path:"/",query:{mode:v,security:m}}),x={url:b,alias:f,name:f,type:"ftp",home:null},"/"!==y&&(x.home=y),h.Z.loader.destroy(),r.abrupt("return",x);case 30:if(r.prev=30,r.t0=r.catch(15),!n){r.next=35;break}return n=!1,r.abrupt("return");case 35:return h.Z.loader.destroy(),r.next=38,p.Z.error(r.t0);case 38:return r.next=40,t.addFtp(i,o,c,f,u,m,v);case 40:return r.abrupt("return",r.sent);case 41:case"end":return r.stop()}}),r,null,[[15,30]])})))()},addSftp:function(){var e=arguments,t=this;return(0,a.Z)(s().mark((function r(){var n,a,i,o,c,u,l,d,f,m,v,g,y,b,x,Z,w,S,O,P,F;return s().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return F=function(e,t,r,n,a,i,o){var s=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"password",c="password"===s,u=[{id:"alias",placeholder:"Name",type:"text",value:o||"",required:!0},{id:"username",placeholder:"Username (optional)",type:"text",value:t},{id:"hostname",placeholder:"Hostname",type:"text",required:!0,value:e},["Authentication type: ",{id:"usePassword",placeholder:"Password",name:"authType",type:"radio",value:c,onchange:function(){this.value&&(this.prompt.$body.get("#password").hidden=!1,this.prompt.$body.get("#keyFile").hidden=!0,this.prompt.$body.get("#passPhrase").hidden=!0)}},{id:"useKeyFile",placeholder:"Key file",name:"authType",type:"radio",value:!c,onchange:function(){if(this.value){var e=this.prompt.$body.get("#password");e.hidden=!0,e.value="",this.prompt.$body.get("#keyFile").hidden=!1,this.prompt.$body.get("#passPhrase").hidden=!1}}}],{id:"password",placeholder:"Password",name:"password",type:"password",value:n,hidden:!c},{id:"keyFile",placeholder:"Select key file",name:"keyFile",hidden:c,value:r,type:"text",onclick:function(){var e=this;sdcard.openDocumentFile((function(t){e.value=t.uri}))}},{id:"passPhrase",placeholder:"Passphrase (optional)",name:"passPhrase",type:"password",hidden:c,value:a},{id:"port",placeholder:"Port (optional)",type:"number",value:i=i||22}];return h.Z.multiPrompt(strings["add sftp"],u)},n=!1,r.next=4,F.apply(void 0,(0,D.Z)(e));case 4:return a=r.sent,i=a.hostname,o=a.username,c=a.keyFile,u=a.password,l=a.passPhrase,d=a.port,f=a.alias,m=a.usePassword,v=m?"password":"keyFile",h.Z.loader.create(strings["add sftp"],strings.connecting+"...",{timeout:1e4,callback:function(){n=!0}}),g=(0,E.Z)(i,parseInt(d),o,{password:u,keyFile:c,passPhrase:l}),r.prev=16,r.next=19,g.pwd();case 19:if(y=r.sent,!n){r.next=23;break}return n=!1,r.abrupt("return");case 23:if(b="",!c){r.next=44;break}return x=(0,k.Z)(c),r.next=28,x.readFile();case 28:return Z=r.sent,w=new TextDecoder("utf-8").decode(new Uint8Array(Z)),S=c.hashCode(),b=A.Z.join(DATA_STORAGE,S),x=(0,k.Z)(b),r.next=35,x.exists();case 35:if(!r.sent){r.next=41;break}return r.next=39,x.writeFile(w);case 39:r.next=44;break;case 41:return O=(0,k.Z)(DATA_STORAGE),r.next=44,O.createFile(S,w);case 44:return P=A.Z.formate({protocol:"sftp:",hostname:i,username:o,password:u,port:d,path:"/",query:{keyFile:b,passPhrase:l}}),h.Z.loader.destroy(),r.abrupt("return",{alias:f,name:f,url:P,type:"sftp",home:y});case 49:if(r.prev=49,r.t0=r.catch(16),!n){r.next=54;break}return n=!1,r.abrupt("return");case 54:return h.Z.loader.destroy(),r.next=57,p.Z.error(r.t0);case 57:return r.next=59,t.addSftp(i,o,c,u,l,d,f,v);case 59:return r.abrupt("return",r.sent);case 60:case"end":return r.stop()}}),r,null,[[16,49]])})))()},edit:function(e){var t=e.name,r=e.storageType,n=e.url,a=C()(n,!0),i=a.username,o=a.password,s=a.hostname,c=a.port,u=a.query;if(i&&(i=decodeURIComponent(i)),o&&(o=decodeURIComponent(o)),"ftp"===r){var l=u.security,d=u.mode;return l&&(l=decodeURIComponent(l)),d&&(d=decodeURIComponent(d)),this.addFtp(i,o,s,t,c,l,d)}if("sftp"===r){var p=u.passPhrase,f=u.keyFile;return p&&(p=decodeURIComponent(p)),f&&(f=decodeURIComponent(f)),this.addSftp(s,i,f,o,p,c,t,o?"password":"key")}return null}};function q(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(e){if("string"==typeof e)return U(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?U(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,a=function(){};return{s:a,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,s=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return o=e.done,e},e:function(e){s=!0,i=e},f:function(){try{o||null==r.return||r.return()}finally{if(s)throw i}}}}function U(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function B(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function M(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?B(Object(r),!0).forEach((function(t){(0,i.Z)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):B(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var H=function(e,t,r){var i=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];e=e||"file",r=r||strings["select folder"];var o=["folder","both"].includes(e),c=["file","both"].includes(e),v=p.Z.parseJSON(localStorage.fileBrowserState)||[],P=[],F=[],D=JSON.parse(localStorage.storageList||"[]");return t||(t="both"!==e?o?strings["open folder"]:strings["open file"]:strings["file browser"]),new Promise((function(E,I){var L,U=u()("i",{className:"icon more_vert",attr:{action:"toggle-menu"}}),B=u()("i",{className:"icon add",attr:{action:"toggle-add-menu"}}),H=u()("i",{className:"icon search",attr:{action:"search"}}),J=u()("span",{className:"icon clearclose",attr:{action:"close"}}),$=(0,d.Z)(strings["file browser"].capitalize(),{lead:J}),z=u().parse(l.Z.render(y,{type:e,info:t})),G=z.get(".navigation"),K={top:"8px",right:"8px",toggle:U,transformOrigin:"top right"},X=(0,f.Z)(M({innerHTML:function(){return'\n        <li action="settings">'.concat(strings.settings.capitalize(0),'</li>\n        <li action="refresh">').concat(strings["reset connections"].capitalize(0),'</li>\n        <li action="reload">').concat(strings.reload.capitalize(0),"</li>\n        ")}},K)),V=(0,f.Z)(M({innerHTML:function(){if("/"===Y.url){var e=!localStorage.__fbAddSftp,t=!localStorage.__fbAddPath;return l.Z.render(Z,M({addPathNotice:t,addSftpNotice:e},strings))}return l.Z.render(x,strings)}},(K.toggle=B)&&K)),W={},Q={},Y={url:null,name:null,list:[],scroll:0};if(actionStack.setMark(),J.onclick=$.hide,z.addEventListener("click",te),z.addEventListener("contextmenu",re),$.append(z),$.get("header").append(H,B,U),app.append($),actionStack.push({id:"filebrowser",action:function(){var e=new Error("User cancelled");Object.defineProperty(e,"code",{value:0}),I(e),$.hide()}}),X.onclick=function(e){X.hide();var t=e.target.getAttribute("action");if("settings"!==t){if("reload"===t){var r=Y.url;return r in Q&&delete Q[r],void ye()}if("refresh"===t)return ftp.disconnect((function(){}),(function(){})),sftp.close((function(){}),(function(){})),void toast(strings.success);ne()}else g(ye)},V.onclick=function(e){V.hide();var t=e.target,r=t.getAttribute("action"),n=t.getAttribute("value");if(r){switch(r){case"create":!function(e){le.apply(this,arguments)}(n);break;case"add-path":localStorage.__fbAddPath=!0,xe();break;case"addFtp":case"addSftp":"addSftp"===r&&(localStorage.__fbAddSftp=!0),R[r]().then((function(e){ve(e)})).catch((function(e){e&&console.error(e)}))}ne()}},H.onclick=function(){var e=z.get("#list");e&&(0,S.Z)(e)},$.onhide=function(){actionStack.clearFromMark(),actionStack.remove("filebrowser"),z.removeEventListener("click",te),z.removeEventListener("contextmenu",re),document.removeEventListener("resume",ye)},o){var ee=u()("button",{textContent:r});L=u()("footer",{className:"button-container",child:ee}),$.setAttribute("footer-height",1),$.append(L),ee.onclick=function(){$.hide(),E(M({type:"folder"},Y))}}function te(e,t){var r=e.target,n=r.getAttribute("action");if(n){var i=r.data_url,o=r.data_name||r.getAttribute("name"),c=r.hasAttribute("open-doc"),u=r.getAttribute("uuid"),l=r.getAttribute("type"),d=r.getAttribute("storageType"),f=r.getAttribute("home"),v=["dir","directory","folder"].includes(l);if(!i){var g=r.get("data-url");g&&(i=g.textContent)}if("notification"!==d){if(!i&&"open"===n&&v&&!c&&!t)return h.Z.loader.hide(),void _(o,u).then((function(e){var t=F.find((function(e){return e.uuid===u}));t.url=e.uri,t.name=e.name,o=e.name,ve(t,!1),i=e.uri,y()}));switch(c&&(n="open-doc"),t&&(n="contextmenu"),n){case"navigation":y();break;case"contextmenu":!function(){if(appSettings.value.vibrateOnTap&&navigator.vibrate(m.Z.VIBRATION_TIME),"true"!==r.getAttribute("open-doc")){var e=[["delete",strings.delete,"delete"],["rename",strings.rename,"text_format"]];/s?ftp/.test(d)&&e.push(["edit",strings.edit,"edit"]),p.Z.isFile(l)&&e.push(["info",strings.info,"info"]),h.Z.select("",e).then((function(e){switch(e){case"delete":h.Z.confirm(strings.warning.toUpperCase(),strings["delete {name}"].replace("{name}",o)).then(b);break;case"rename":h.Z.prompt(strings.rename,o,"text",{match:m.Z.FILE_NAME_REGEX}).then((function(e){!function(e){u?function(e){D=D.map((function(t){return t.uuid===u&&(t.name=e),t})),localStorage.storageList=JSON.stringify(D),ye()}(e):function(e){x.apply(this,arguments)}(e)}(e)}));break;case"edit":R.edit(D.find((function(e){return e.uuid===u}))).then((function(e){e&&(e.uuid=u,ve(e))})).catch((function(e){e&&console.error(e)}));break;case"info":Acode.exec("file-info",i)}}))}}();break;case"open":v?y():r.hasAttribute("disabled")||($.hide(),E({type:"file",url:i,name:o}));break;case"open-doc":sdcard.openDocumentFile((function(e){e.url=e.uri,E(M(M({type:"file"},e),{},{name:e.filename,mode:"single"})),$.hide()}),(function(e){p.Z.error(e)}))}}else"addstorage"===u&&xe()}function y(){f?function(){var e,t=[],r=f.split("/"),n=A.Z.parse(i),a=n.url,s=n.query,c="",u=q(r);try{for(u.s();!(e=u.n()).done;){var l=e.value;c=A.Z.join(c,l),t.push({url:"".concat(A.Z.join(a,c,"")).concat(s),name:l||o})}}catch(e){u.e(e)}finally{u.f()}pe(t)}():ce(i,o)}function b(){u?(i&&(N.Z.removeFolder(i),N.Z.removeFile(i)),D=D.filter((function(e){if(e.uuid!==u)return!0;if(e.url){var t=C()(e.url,!0),r=decodeURIComponent(t.query.keyFile||"");r&&(0,k.Z)(r).deleteFile()}return!1})),localStorage.storageList=JSON.stringify(D),ye()):function(){Z.apply(this,arguments)}()}function x(){return(x=(0,a.Z)(s().mark((function e(t){var r,n;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=(0,k.Z)(i),e.prev=1,e.next=4,r.renameTo(t);case 4:n=e.sent,T.Z.updateItem(i,n,t),toast(strings.success),ye(),e.next=13;break;case 10:e.prev=10,e.t0=e.catch(1),p.Z.error(e.t0);case 13:case"end":return e.stop()}}),e,null,[[1,10]])})))).apply(this,arguments)}function Z(){return(Z=(0,a.Z)(s().mark((function e(){var t,r;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,t=(0,k.Z)(i),!p.Z.isFile(l)){e.next=5;break}return e.next=5,t.deleteFile();case 5:if(!p.Z.isDir(l)){e.next=8;break}return e.next=8,t.deleteDir();case 8:N.Z.removeFile(i),p.Z.isDir(l)?(p.Z.updateUriOfAllActiveFiles(i),N.Z.removeFolder(i),T.Z.removeItem(i),T.Z.removeFolders(i)):(r=editorManager.getFile(i,"uri"))&&(r.uri=null),delete Q[i],ye(),toast(strings.success),e.next=18;break;case 15:e.prev=15,e.t0=e.catch(0),p.Z.error(e.t0);case 18:case"end":return e.stop()}}),e,null,[[0,15]])})))).apply(this,arguments)}}function re(e){te(e,!0)}function ne(){localStorage.__fbAddPath&&localStorage.__fbAddSftp?B.classList.remove("notice"):B.classList.add("notice")}function ae(){return ie.apply(this,arguments)}function ie(){return(ie=(0,a.Z)(s().mark((function e(){var t,r,n,a;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=!0,o&&L.classList.add("disabled"),F.length=0,29!=ANDROID_SDK_INT){e.next=25;break}return r=cordova.file.externalRootDirectory,n="Acode_Test_file"+p.Z.uuid(),a=(0,k.Z)(A.Z.join(r,n)),e.prev=7,e.next=10,(0,k.Z)(r).createDirectory(n);case 10:return e.next=12,a.createFile("test"+p.Z.uuid());case 12:return e.next=14,a.lsDir();case 14:t=!!e.sent.length,e.next=20;break;case 17:e.prev=17,e.t0=e.catch(7),console.error(e.t0);case 20:return e.prev=20,a.deleteDir(),e.finish(20);case 23:e.next=26;break;case 25:ANDROID_SDK_INT>29&&(t=!1);case 26:return t&&j(F,"Internal storage",cordova.file.externalRootDirectory,{uuid:"internal-storage"}),e.prev=27,e.next=30,w.Z.listStorages();case 30:e.sent.forEach((function(e){var t;D.find((function(t){return t.uuid===e.uuid}))||(e.path&&isStorageManager&&(t="file://"+e.path),j(F,e.name,t||"",M(M({},e),{},{storageType:"sd"})))})),e.next=36;break;case 34:e.prev=34,e.t1=e.catch(27);case 36:return D.forEach((function(e){var t=e.url||e.uri;j(F,e.name,t,{storageType:e.storageType,uuid:e.uuid,home:e.home})})),F.length||j(F,strings["add a storage"],"",{storageType:"notification",uuid:"addstorage"}),c&&j(F,"Select document",null,{"open-doc":!0}),e.abrupt("return",F);case 40:case"end":return e.stop()}}),e,null,[[7,17,20,23],[27,34]])})))).apply(this,arguments)}function oe(e,t){return se.apply(this,arguments)}function se(){return se=(0,a.Z)(s().mark((function t(r,n){var a,i,o,c,u,l;return s().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(a=appSettings.value.fileBrowser,i=null,o=!1,!(r in Q)){t.next=7;break}return t.abrupt("return",Q[r]);case 7:if("/"!==r){t.next=13;break}return t.next=10,ae();case 10:i=t.sent,t.next=30;break;case 13:return c=p.Z.uuid(),W[c]=!0,u=setTimeout((function(){h.Z.loader.create(n,strings.loading+"...",{timeout:1e4,callback:function(){h.Z.loader.destroy(),ce("/","/"),W[c]=!1}})}),100),l=(0,k.Z)(r),t.prev=17,t.next=20,l.lsDir();case 20:i=t.sent,t.next=26;break;case 23:t.prev=23,t.t0=t.catch(17),W[c]?p.Z.error(t.t0,r):console.error(t.t0);case 26:o=!W[c],delete W[c],clearTimeout(u),h.Z.loader.destroy();case 30:if(!o){t.next=32;break}return t.abrupt("return",null);case 32:return t.abrupt("return",{url:r,name:n,scroll:0,list:p.Z.sortDir(i,a,me,e)});case 33:case"end":return t.stop()}}),t,null,[[17,23]])}))),se.apply(this,arguments)}function ce(e,t){return ue.apply(this,arguments)}function ue(){return ue=(0,a.Z)(s().mark((function e(t,r){var n,a,c,l,d,p,f,h,m,v,g,y=arguments;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=!(y.length>2&&void 0!==y[2])||y[2],t){e.next=3;break}throw new Error('navigate(url, name): "url" is required.');case 3:if(r){e.next=5;break}throw new Error('navigate(url, name): "name" is required.');case 5:if("/"===t?o&&L.classList.add("disabled"):o&&L.classList.remove("disabled"),!(a=u().get("#".concat(fe(t))))){e.next=22;break}for(;(c=G.lastChild)!==a;)l=c.data_url,actionStack.remove(l),c.remove();case 9:if((d=P.slice(-1)[0])&&d.url!==t){e.next=13;break}return e.abrupt("break",16);case 13:P.pop(),e.next=9;break;case 16:return localStorage.fileBrowserState=JSON.stringify(P),e.next=19,oe(t,r);case 19:return(p=e.sent)&&ge(p),e.abrupt("return");case 22:return e.next=24,oe(t,r);case 24:(f=e.sent)&&(m=(h=Y).url,v=h.name,i&&be({name:r,url:t}),m&&v&&n&&(g=function(){ce(m,v,!1)}),de(r,t,g),ge(f));case 26:case"end":return e.stop()}}),e)}))),ue.apply(this,arguments)}function le(){return le=(0,a.Z)(s().mark((function e(t){var r,n,i,o,c,u,l,d,f,v,g,y,b,x,Z,w,S,P,F;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(F=function(){return F=(0,a.Z)(s().mark((function e(t,r,a,i){var u,d,p,f,h;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(u=A.Z.join(c,o),d=(0,k.Z)(u),0!==i.length){e.next=7;break}return p=t[r].replace(/<%name%>/g,l),e.next=6,d.createFile(a,p);case 6:return e.abrupt("return");case 7:if(f=i.splice(0,1)[0],h=A.Z.join(u,f),n.includes(h)){e.next=13;break}return e.next=12,d.createDirectory(f);case 12:n.push(h);case 13:return o+=f+"/",e.next=16,P(t,r,a,i);case 16:return e.abrupt("return",e.sent);case 17:case"end":return e.stop()}}),e)}))),F.apply(this,arguments)},P=function(e,t,r,n){return F.apply(this,arguments)},S=function(e){var t=e.split("/"),r=t.pop();return P(u,e,r,t)},w=function(){return w=(0,a.Z)(s().mark((function e(t){var n;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.length){e.next=4;break}return he(r),ye(),e.abrupt("return");case 4:return o="",n=t.pop(),e.next=8,S(n);case 8:return e.next=10,Z(t);case 10:return e.abrupt("return",e.sent);case 11:case"end":return e.stop()}}),e)}))),w.apply(this,arguments)},Z=function(e){return w.apply(this,arguments)},r=Y.url,n=[],i=[],o="",c=null,u="",l="",d="","file"!==t&&"folder"!==t){e.next=39;break}return f=strings["enter folder name"],v=strings["new folder"],"file"===t&&(f=strings["enter file name"],v="untitled.txt"),e.next=19,h.Z.prompt(f,v,"filename",{match:m.Z.FILE_NAME_REGEX,required:!0});case 19:if(g=e.sent){e.next=22;break}return e.abrupt("return");case 22:if(g=p.Z.removeLineBreaks(g),e.prev=23,y=(0,k.Z)(r),"folder"!==t){e.next=28;break}return e.next=28,y.createDirectory(g);case 28:if("file"!==t){e.next=31;break}return e.next=31,y.createFile(g);case 31:he(r),ye(),e.next=38;break;case 35:e.prev=35,e.t0=e.catch(23),p.Z.error(e.t0);case 38:return e.abrupt("return");case 39:if("project"!==t){e.next=67;break}return Object.keys(O).map((function(e){i.push([e,e,"icon "+e])})),e.next=43,h.Z.select(strings["new project"],i);case 43:return d=e.sent,h.Z.loader.create(d,strings.loading+"..."),e.next=47,O[d]();case 47:return u=e.sent.default,h.Z.loader.destroy(),e.next=51,h.Z.prompt(strings["project name"],d,"text",{required:!0,match:m.Z.FILE_NAME_REGEX});case 51:return l=e.sent,e.prev=52,b=(0,k.Z)(r),h.Z.loader.create(l,strings.loading+"..."),e.next=57,b.createDirectory(l);case 57:return c=A.Z.join(r,l,"/"),x=Object.keys(u),e.next=61,Z(x);case 61:e.next=66;break;case 63:e.prev=63,e.t1=e.catch(52),p.Z.error(e.t1);case 66:h.Z.loader.destroy();case 67:case"end":return e.stop()}}),e,null,[[23,35],[52,63]])}))),le.apply(this,arguments)}function de(e,t,r){G.append(u()("span",{id:fe(t),className:"nav",data_url:t,data_name:e,attr:{action:"navigation",text:e},tabIndex:-1})),G.scrollLeft=G.scrollWidth,r&&!actionStack.has(t)&&actionStack.push({id:t,action:r})}function pe(e){if(Array.isArray(e)){for(var t=[],r=e.pop(),a=r.url,o=r.name,s=Y,c=s.url,u=s.name;e.length;){var l=e.splice(0,1)[0],d=l.url,p=l.name,f=void 0;i&&be({name:p,url:d}),c&&u&&(t.push([c,u]),f=function(){var e=t.pop(),r=(0,n.Z)(e,2);ce(r[0],r[1],!1)}),de(p,d,f),c=d,u=p}Y={url:c,name:u},ce(a,o)}}function fe(e){return"nav_".concat(e.hashCode())}function he(e){Q[e]&&delete Q[e],Q[Y.url]&&delete Q[Y.url];var t,r=new RegExp(A.Z.parse(e).url),n=q(addedFolder);try{for(n.s();!(t=n.n()).done;){var a=t.value;a.url===e?a.remove():r.test(Y.url)&&a.reload()}}catch(e){n.e(e)}finally{n.f()}}function me(e){var t=p.Z.extname(e);return!appSettings.value.filesNotAllowed.includes((t||"").toLowerCase())}function ve(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];e.uuid?D=D.filter((function(t){return t.uuid!==e.uuid})):e.uuid=p.Z.uuid(),e.type||(e.type="dir"),e.storageType||(e.storageType=e.type),D.push(e),localStorage.storageList=JSON.stringify(D),t&&ye()}function ge(e){var t=e.list,r=e.scroll,n=u().parse(l.Z.render(b,{msg:strings["empty folder message"],list:t})),a=z.get("#list");if(a){var i=Y.url;i&&Q[i]&&(Q[i].scroll=a.scrollTop),a.remove()}z.append(n),n.scrollTop=r,n.focus(),"/"===e.url?ne():(U.classList.remove("notice"),B.classList.remove("notice")),Y=e,Q[e.url]=e}function ye(){var e=Y,t=e.url,r=e.name;delete Q[t],ce(t,r)}function be(e){var t=e.url,r=e.name;t&&r&&(P.find((function(e){return e.url===t}))||(P.push({url:t,name:r}),localStorage.fileBrowserState=JSON.stringify(P)))}function xe(){_().then((function(e){D.push(e),localStorage.storageList=JSON.stringify(D),ye()})).catch((function(e){p.Z.error(e)}))}i&&v.length?pe(v):ce("/","/")}))}}}]);